# NOOX æ™ºèƒ½ç¡¬ä»¶å¹³å°ç”¨æˆ·æŒ‡å—

## æ–‡æ¡£ä¿¡æ¯

- **é¡¹ç›®åç§°**: NOOX ESP32-S3 AI æ™ºèƒ½ç¡¬ä»¶å¹³å°
- **æ–‡æ¡£ç‰ˆæœ¬**: 2.0
- **é€‚ç”¨å›ºä»¶ç‰ˆæœ¬**: v3.0+
- **æ–‡æ¡£æ—¥æœŸ**: 2025-10-12
- **é¢å‘ç”¨æˆ·**: å¼€å‘è€…ã€é«˜çº§ç”¨æˆ·ã€ç³»ç»Ÿé›†æˆå•†

---

## ç›®å½•

1. [å¿«é€Ÿå…¥é—¨](#1-å¿«é€Ÿå…¥é—¨)
2. [ç¡¬ä»¶è¿æ¥](#2-ç¡¬ä»¶è¿æ¥)
3. [é¦–æ¬¡é…ç½®](#3-é¦–æ¬¡é…ç½®)
4. [Web ç•Œé¢ä½¿ç”¨](#4-web-ç•Œé¢ä½¿ç”¨)
5. [OLED ç•Œé¢æ“ä½œ](#5-oled-ç•Œé¢æ“ä½œ)
6. [USB Shell äº¤äº’](#6-usb-shell-äº¤äº’)
7. [LLM åŠŸèƒ½è¯¦è§£](#7-llm-åŠŸèƒ½è¯¦è§£)
8. [é«˜çº§åŠŸèƒ½](#8-é«˜çº§åŠŸèƒ½)
9. [æ•…éšœæ’é™¤](#9-æ•…éšœæ’é™¤)
10. [æœ€ä½³å®è·µ](#10-æœ€ä½³å®è·µ)
11. [API é›†æˆ](#11-api-é›†æˆ)

---

## 1. å¿«é€Ÿå…¥é—¨

### 1.1 ç³»ç»Ÿè¦æ±‚

#### ç¡¬ä»¶è¦æ±‚

- **NOOX ESP32-S3 è®¾å¤‡** Ã— 1
- **USB Type-C æ•°æ®çº¿** Ã— 1
- **è®¡ç®—æœº**ï¼ˆWindows/macOS/Linuxï¼‰
- **WiFi è·¯ç”±å™¨**ï¼ˆ2.4 GHzï¼‰

#### è½¯ä»¶è¦æ±‚

- **Web æµè§ˆå™¨**ï¼ˆChrome/Edge/Firefox/Safariï¼‰
- **ä¸»æœºä»£ç†ç¨‹åº**ï¼ˆå¯é€‰ï¼Œç”¨äº USB Shell åŠŸèƒ½ï¼‰
- **ä¸²å£ç›‘è§†å™¨**ï¼ˆå¯é€‰ï¼Œç”¨äºè°ƒè¯•ï¼‰

### 1.2 5 åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹

#### ç¬¬ä¸€æ­¥ï¼šè¿æ¥ç¡¬ä»¶

1. ä½¿ç”¨ USB Type-C æ•°æ®çº¿è¿æ¥ NOOX è®¾å¤‡åˆ°è®¡ç®—æœº
2. è®¾å¤‡ä¸Šç”µï¼ŒOLED å±å¹•æ˜¾ç¤ºåˆå§‹åŒ–ä¿¡æ¯
3. RGB LED å‘ˆç°è“è‰²è¡¨ç¤ºè®¾å¤‡æ­£å¸¸å¯åŠ¨

#### ç¬¬äºŒæ­¥ï¼šé…ç½® WiFi

**æ–¹æ³• 1ï¼šé€šè¿‡ OLED èœå•**

1. æŒ‰ä¸‹ **Button A (OK)** è¿›å…¥ä¸»èœå•
2. ä½¿ç”¨ **Button B (Up)** å’Œ **Button C (Down)** é€‰æ‹© "WiFi Settings"
3. æŒ‰ **Button A** ç¡®è®¤
4. é€‰æ‹© "Connect Saved"
5. é€‰æ‹©æ‚¨çš„ WiFi ç½‘ç»œå¹¶ç¡®è®¤è¿æ¥

**æ–¹æ³• 2ï¼šé€šè¿‡é…ç½®æ–‡ä»¶**

1. è®¾å¤‡åœ¨è®¡ç®—æœºä¸Šä¼šæ˜¾ç¤ºä¸º U ç›˜ï¼ˆMSD æ¨¡å¼ï¼‰
2. ç¼–è¾‘ `/config.json` æ–‡ä»¶
3. ä¿®æ”¹ `wifi_networks` éƒ¨åˆ†ï¼Œæ·»åŠ æ‚¨çš„ WiFi ä¿¡æ¯ï¼š

```json
{
  "wifi_networks": [
    {
      "ssid": "YourWiFiName",
      "password": "YourPassword"
    }
  ]
}
```

4. ä¿å­˜æ–‡ä»¶å¹¶é‡å¯è®¾å¤‡

#### ç¬¬ä¸‰æ­¥ï¼šè®¿é—® Web ç•Œé¢

1. OLED å±å¹•ä¼šæ˜¾ç¤ºè®¾å¤‡çš„ IP åœ°å€ï¼ˆä¾‹å¦‚ï¼š192.168.1.100ï¼‰
2. åœ¨æµè§ˆå™¨ä¸­è¾“å…¥è¯¥ IP åœ°å€
3. è¿›å…¥ NOOX Web æ§åˆ¶å°

#### ç¬¬å››æ­¥ï¼šé…ç½® LLM

1. ç‚¹å‡»å³ä¸Šè§’çš„ **è®¾ç½®æŒ‰é’®** (âš™ï¸)
2. åœ¨ "LLM æä¾›å•†" éƒ¨åˆ†ï¼š
   - é€‰æ‹©æä¾›å•†ï¼ˆDeepSeek/OpenRouter/OpenAIï¼‰
   - è¾“å…¥ API Key
   - é€‰æ‹©æ¨¡å‹
3. ç‚¹å‡» **ä¿å­˜å¹¶åº”ç”¨**

#### ç¬¬äº”æ­¥ï¼šå¼€å§‹å¯¹è¯

1. åœ¨èŠå¤©çª—å£è¾“å…¥æ‚¨çš„é—®é¢˜
2. æŒ‰å›è½¦æˆ–ç‚¹å‡»å‘é€æŒ‰é’®
3. ç­‰å¾… AI å“åº”

**æ­å–œï¼æ‚¨å·²æˆåŠŸè®¾ç½® NOOX è®¾å¤‡ã€‚**

---

## 2. ç¡¬ä»¶è¿æ¥

### 2.1 è®¾å¤‡æ¥å£è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          NOOX ESP32-S3              â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ OLED   â”‚    â—‰ RGB LED            â”‚
â”‚  â”‚ 128x64 â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â— LED1  â— LED2  â— LED3
â”‚                                     â”‚
â”‚  [B1] [B2] [B3]  â† æŒ‰é”®              â”‚
â”‚  (OK) (â†‘)  (â†“)                      â”‚
â”‚                                     â”‚
â”‚  [USB-C] â† æ•°æ®/ç”µæº                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŒ‰é”®å®šä¹‰

| æŒ‰é”® | åç§° | GPIO | åŠŸèƒ½ |
|------|------|------|------|
| B1 | Button A | GPIO47 | ç¡®è®¤/é€‰æ‹©/è¿›å…¥èœå• |
| B2 | Button B | GPIO21 | å‘ä¸Š/å‘å‰ç¿»é¡µ |
| B3 | Button C | GPIO38 | å‘ä¸‹/å‘åç¿»é¡µ |

**æŒ‰é”®ç‰¹æ€§**:
- é«˜ç”µå¹³è§¦å‘ï¼ˆæŒ‰ä¸‹æ—¶ä¸º HIGHï¼‰
- å†…éƒ¨ä¸‹æ‹‰ç”µé˜»
- ç¡¬ä»¶æ¶ˆæŠ–å»¶è¿Ÿï¼š200ms

### 2.3 LED æŒ‡ç¤º

#### RGB LED çŠ¶æ€æŒ‡ç¤º

| é¢œè‰² | çŠ¶æ€ |
|------|------|
| ğŸ”µ è“è‰² | è®¾å¤‡å¯åŠ¨ä¸­ |
| ğŸŸ¢ ç»¿è‰² | WiFi å·²è¿æ¥ |
| ğŸŸ¡ é»„è‰² | WiFi è¿æ¥ä¸­ |
| ğŸ”´ çº¢è‰² | WiFi è¿æ¥å¤±è´¥ / é”™è¯¯ |
| âšª ç™½è‰² | LLM è¯·æ±‚å¤„ç†ä¸­ |
| âš« ç†„ç­ | ç©ºé—² |

#### å•è‰² LED

- **LED 1/2/3**: å¯é€šè¿‡ LLM æˆ– Web ç•Œé¢æ§åˆ¶

### 2.4 æ‰©å±•æ¥å£ï¼ˆé«˜çº§ç”¨æˆ·ï¼‰

#### I2C é¢„ç•™æ¥å£

| å¼•è„š | GPIO | ç”¨é€” |
|------|------|------|
| SDA | GPIO1 | I2C æ•°æ®çº¿ |
| SCL | GPIO2 | I2C æ—¶é’Ÿçº¿ |

**ç”¨é€”ç¤ºä¾‹**:
- è¿æ¥é¢å¤–çš„ä¼ æ„Ÿå™¨ï¼ˆæ¸©æ¹¿åº¦ã€æ°”å‹ç­‰ï¼‰
- è¿æ¥ç¬¬äºŒå— OLED æ˜¾ç¤ºå±
- è¿æ¥ I2C æ¨¡å—ï¼ˆRTCã€EEPROM ç­‰ï¼‰

#### SPI æ¥å£ (TF å¡)

| å¼•è„š | GPIO | ç”¨é€” |
|------|------|------|
| CS | GPIO6 | ç‰‡é€‰ |
| SCK | GPIO15 | æ—¶é’Ÿ |
| MISO | GPIO16 | ä¸»å…¥ä»å‡º |
| MOSI | GPIO7 | ä¸»å‡ºä»å…¥ |

**ç”¨é€”**:
- æ‰©å±•å­˜å‚¨ï¼ˆæ—¥å¿—è®°å½•ï¼‰
- æ•°æ®é‡‡é›†ç¼“å­˜

#### UART æ‰©å±•

| å¼•è„š | GPIO | ç”¨é€” |
|------|------|------|
| TX | GPIO17 | å‘é€ |
| RX | GPIO18 | æ¥æ”¶ |

**ç”¨é€”**:
- è¿æ¥å¤–éƒ¨æ¨¡å—ï¼ˆGPSã€è“ç‰™æ¨¡å—ï¼‰
- è°ƒè¯•è¾“å‡º

#### é€šç”¨ GPIO

- GPIO8, GPIO9, GPIO10

**ç”¨é€”**:
- å¯é€šè¿‡ LLM æ§åˆ¶çš„è¾“å‡ºå¼•è„š
- è‡ªå®šä¹‰ä¼ æ„Ÿå™¨è¾“å…¥

---

## 3. é¦–æ¬¡é…ç½®

### 3.1 é…ç½® WiFi

#### æ–¹æ³• 1ï¼šé€šè¿‡ OLED ç•Œé¢

**æ­¥éª¤**:

1. å¼€æœºåï¼Œè®¾å¤‡æ˜¾ç¤ºçŠ¶æ€å±å¹•
2. æŒ‰ **Button A (OK)** è¿›å…¥ä¸»èœå•
3. é€‰æ‹© **WiFi Settings**ï¼ŒæŒ‰ **OK**
4. é€‰æ‹©ä»¥ä¸‹é€‰é¡¹ä¹‹ä¸€ï¼š
   - **Connect Saved**: è¿æ¥å·²ä¿å­˜çš„ç½‘ç»œ
   - **Scan Networks**: æ‰«æå¯ç”¨ç½‘ç»œï¼ˆæœªå®ç°ï¼‰
   - **Disconnect**: æ–­å¼€å½“å‰è¿æ¥

**è¿æ¥å·²ä¿å­˜ç½‘ç»œ**:

1. é€‰æ‹© **Connect Saved**
2. ä½¿ç”¨ **Up/Down** æŒ‰é”®æµè§ˆç½‘ç»œåˆ—è¡¨
3. é€‰æ‹©ç›®æ ‡ç½‘ç»œï¼ŒæŒ‰ **OK**
4. è®¾å¤‡å°è¯•è¿æ¥ï¼ŒOLED æ˜¾ç¤ºè¿æ¥çŠ¶æ€

#### æ–¹æ³• 2ï¼šç¼–è¾‘é…ç½®æ–‡ä»¶

**æ­¥éª¤**:

1. è®¾å¤‡é€šè¿‡ USB è¿æ¥åï¼Œä¼šæ˜¾ç¤ºä¸º U ç›˜
2. æ‰“å¼€ `/config.json` æ–‡ä»¶
3. æ‰¾åˆ° `wifi_networks` æ•°ç»„ï¼š

```json
"wifi_networks": [
  {
    "ssid": "YourWiFiName",
    "password": "YourPassword"
  },
  {
    "ssid": "OfficeWiFi",
    "password": "OfficePassword"
  }
]
```

4. æ·»åŠ æˆ–ä¿®æ”¹ç½‘ç»œä¿¡æ¯
5. ä¿å­˜æ–‡ä»¶
6. é‡å¯è®¾å¤‡ï¼ˆæ‹”æ’ USB æˆ–é€šè¿‡ OLED èœå•ï¼‰

#### æ–¹æ³• 3ï¼šé€šè¿‡ Web ç•Œé¢

**å‰æ**: è®¾å¤‡å·²è¿æ¥åˆ° WiFi

1. è®¿é—® Web æ§åˆ¶å°
2. ç‚¹å‡» **è®¾ç½®** æŒ‰é’®
3. åœ¨ "WiFi ç®¡ç†" éƒ¨åˆ†ï¼š
   - ç‚¹å‡» **æ·»åŠ ç½‘ç»œ**
   - è¾“å…¥ SSID å’Œå¯†ç 
   - ç‚¹å‡» **ä¿å­˜**
4. é€‰æ‹©ç½‘ç»œå¹¶ç‚¹å‡» **è¿æ¥**

### 3.2 é…ç½® LLM

#### æ”¯æŒçš„ LLM æä¾›å•†

| æä¾›å•† | è·å– API Key | å…è´¹æ¨¡å‹ |
|--------|--------------|----------|
| **DeepSeek** | [platform.deepseek.com](https://platform.deepseek.com) | âœ… deepseek-chat (200ä¸‡tokens/å¤©) |
| **OpenRouter** | [openrouter.ai](https://openrouter.ai) | âœ… å¤šç§å…è´¹æ¨¡å‹ |
| **OpenAI** | [platform.openai.com](https://platform.openai.com) | âŒ éœ€ä»˜è´¹ |

#### é…ç½®æ­¥éª¤

**æ–¹æ³• 1ï¼šé€šè¿‡ Web ç•Œé¢**

1. è®¿é—® Web æ§åˆ¶å°ï¼ˆhttp://è®¾å¤‡IPåœ°å€ï¼‰
2. ç‚¹å‡»å³ä¸Šè§’ **è®¾ç½®** å›¾æ ‡ (âš™ï¸)
3. åœ¨ "LLM é…ç½®" éƒ¨åˆ†ï¼š
   - **æä¾›å•†**: é€‰æ‹© DeepSeek / OpenRouter / OpenAI
   - **API Key**: ç²˜è´´æ‚¨çš„å¯†é’¥
   - **æ¨¡å‹**: ä»ä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©æ¨¡å‹
4. ç‚¹å‡» **ä¿å­˜å¹¶åº”ç”¨**
5. ç³»ç»Ÿä¼šé‡æ–°åŠ è½½é…ç½®

**æ–¹æ³• 2ï¼šç¼–è¾‘é…ç½®æ–‡ä»¶**

ç¼–è¾‘ `/config.json`ï¼š

```json
{
  "last_used": {
    "llm_provider": "deepseek",
    "model": "deepseek-chat",
    "wifi_ssid": "YourWiFi"
  },
  "llm_providers": {
    "deepseek": {
      "api_key": "sk-xxxxxxxxxxxxxxxxxxxxxxxxx",
      "models": ["deepseek-chat", "deepseek-reasoner"]
    },
    "openrouter": {
      "api_key": "sk-or-v1-xxxxxxxxxxxxxxxxxx",
      "models": [
        "z-ai/glm-4.5-air:free",
        "qwen/qwen3-235b-a22b:free",
        "deepseek/deepseek-chat-v3.1:free"
      ]
    },
    "openai": {
      "api_key": "",
      "models": ["gpt-4o", "gpt-3.5-turbo"]
    }
  }
}
```

**å­—æ®µè¯´æ˜**:

- `last_used.llm_provider`: å½“å‰ä½¿ç”¨çš„æä¾›å•†
- `last_used.model`: å½“å‰ä½¿ç”¨çš„æ¨¡å‹
- `api_key`: API å¯†é’¥ï¼ˆå¿…å¡«ï¼‰
- `models`: å¯ç”¨æ¨¡å‹åˆ—è¡¨

### 3.3 éªŒè¯é…ç½®

#### æ£€æŸ¥ WiFi è¿æ¥

**OLED æ˜¾ç¤º**:

```
Mode: Chat
Model: deepseek-chat
SSID: YourWiFi
IP: 192.168.1.100    â† æ˜¾ç¤º IP è¡¨ç¤ºè¿æ¥æˆåŠŸ
Mem: 45% (280KB)
```

**ä¸²å£è¾“å‡º**:

```
Connected to WiFi!
IP Address: 192.168.1.100
```

#### æµ‹è¯• LLM è¿æ¥

1. è®¿é—® Web ç•Œé¢
2. åœ¨èŠå¤©çª—å£è¾“å…¥ï¼š`ä½ å¥½`
3. ç­‰å¾… AI å“åº”
4. å¦‚æœæ”¶åˆ°å›å¤ï¼Œè¯´æ˜é…ç½®æ­£ç¡®

**å¸¸è§é”™è¯¯**:

- `API key invalid`: API å¯†é’¥é”™è¯¯
- `Network timeout`: ç½‘ç»œè¿æ¥é—®é¢˜
- `Model not found`: æ¨¡å‹åç§°é”™è¯¯

---

## 4. Web ç•Œé¢ä½¿ç”¨

### 4.1 ç•Œé¢æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NOOX Platform     [ ğŸ’¬ Chat ] [ ğŸ”§ Advanced ]    âš™ï¸    â”‚ â† é¡¶æ 
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  ğŸ¤– Bot: ä½ å¥½ï¼æˆ‘æ˜¯ NOOX AI åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨çš„ï¼Ÿ  â”‚
â”‚                                                         â”‚
â”‚  ğŸ‘¤ User: å¸®æˆ‘åˆ—å‡ºå½“å‰ç›®å½•çš„æ–‡ä»¶                        â”‚
â”‚                                                         â”‚
â”‚  ğŸ¤– Bot: æ­£åœ¨æ‰§è¡Œå‘½ä»¤...                                â”‚
â”‚         æ–‡ä»¶åˆ—è¡¨ï¼š                                      â”‚
â”‚         - config.json                                   â”‚
â”‚         - index.html.gz                                 â”‚
â”‚         - script.js.gz                                  â”‚
â”‚                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ è¾“å…¥æ‚¨çš„æ¶ˆæ¯...                            ] [å‘é€]  â”‚ â† è¾“å…¥æ¡†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 èŠå¤©åŠŸèƒ½

#### å‘é€æ¶ˆæ¯

1. åœ¨åº•éƒ¨è¾“å…¥æ¡†è¾“å…¥æ‚¨çš„é—®é¢˜æˆ–æŒ‡ä»¤
2. æŒ‰ **Enter** é”®æˆ–ç‚¹å‡» **å‘é€** æŒ‰é’®
3. æ¶ˆæ¯ä¼šç«‹å³æ˜¾ç¤ºåœ¨èŠå¤©çª—å£
4. ç­‰å¾… AI å“åº”ï¼ˆé€šå¸¸ 2-15 ç§’ï¼‰

#### æ¶ˆæ¯ç±»å‹

**æ–‡æœ¬æ¶ˆæ¯**:

```
User: ä»‹ç»ä¸€ä¸‹ ESP32-S3 èŠ¯ç‰‡
Bot: ESP32-S3 æ˜¯ä¹é‘«ç§‘æŠ€æ¨å‡ºçš„...
```

**ä»£ç ç‰‡æ®µ**:

````
User: å†™ä¸€ä¸ª Python Hello World
Bot: 
```python
print("Hello, World!")
```
````

**åˆ—è¡¨å†…å®¹**:

```
User: åˆ—å‡º 5 ç§ç¼–ç¨‹è¯­è¨€
Bot:
1. Python
2. JavaScript
3. C++
4. Java
5. Go
```

### 4.3 æ¨¡å¼åˆ‡æ¢

#### èŠå¤©æ¨¡å¼ (Chat Mode)

**ç‰¹ç‚¹**:
- ç®€å•çš„é—®ç­”äº¤äº’
- ä¸è°ƒç”¨å·¥å…·
- å“åº”é€Ÿåº¦å¿«
- é€‚åˆï¼šé—²èŠã€çŸ¥è¯†é—®ç­”ã€æ–‡æœ¬ç”Ÿæˆ

**ç¤ºä¾‹å¯¹è¯**:

```
User: ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ
Bot: æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªåˆ†æ”¯...

User: æ¨èä¸€æœ¬å…³äº Python çš„ä¹¦
Bot: æˆ‘æ¨èã€Šæµç•…çš„Pythonã€‹...
```

#### é«˜çº§æ¨¡å¼ (Advanced Mode)

**ç‰¹ç‚¹**:
- æ”¯æŒå·¥å…·è°ƒç”¨ï¼ˆShell å‘½ä»¤ã€HID æ§åˆ¶ã€GPIOï¼‰
- å¯ä»¥æ‰§è¡Œå¤æ‚ä»»åŠ¡
- å“åº”æ—¶é—´è¾ƒé•¿
- é€‚åˆï¼šç³»ç»Ÿè‡ªåŠ¨åŒ–ã€æ–‡ä»¶æ“ä½œã€è®¾å¤‡æ§åˆ¶

**ç¤ºä¾‹å¯¹è¯**:

```
User: å¸®æˆ‘åœ¨æ¡Œé¢åˆ›å»ºä¸€ä¸ªåä¸º test.txt çš„æ–‡ä»¶
Bot: [è°ƒç”¨å·¥å…·] execute_shell_command
     å‚æ•°: {"command": "touch ~/Desktop/test.txt"}
     ç»“æœ: æ–‡ä»¶å·²æˆåŠŸåˆ›å»º

User: æ‰“å¼€è®°äº‹æœ¬
Bot: [è°ƒç”¨å·¥å…·] control_keyboard
     å‚æ•°: {"action": "press", "value": "Win+R"}
     å‚æ•°: {"action": "type", "value": "notepad"}
     å‚æ•°: {"action": "press", "value": "Enter"}
     ç»“æœ: è®°äº‹æœ¬å·²æ‰“å¼€
```

**åˆ‡æ¢æ–¹æ³•**:

1. ç‚¹å‡»é¡¶æ çš„ **Chat** æˆ– **Advanced** æŒ‰é’®
2. å½“å‰æ¨¡å¼ä¼šé«˜äº®æ˜¾ç¤º
3. æ¨¡å¼åˆ‡æ¢ä¼šç«‹å³ç”Ÿæ•ˆ

### 4.4 è®¾ç½®é¢æ¿

#### æ‰“å¼€è®¾ç½®

ç‚¹å‡»å³ä¸Šè§’çš„ **âš™ï¸ è®¾ç½®** å›¾æ ‡ï¼Œå·¦ä¾§æ»‘å‡ºè®¾ç½®é¢æ¿ã€‚

#### è®¾ç½®é¡¹è¯´æ˜

**1. LLM é…ç½®**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LLM æä¾›å•†                  â”‚
â”‚  â—‹ DeepSeek                 â”‚
â”‚  â— OpenRouter  â† å½“å‰é€‰ä¸­    â”‚
â”‚  â—‹ OpenAI                   â”‚
â”‚                             â”‚
â”‚  API Key                    â”‚
â”‚  [sk-or-v1-xxxx...]         â”‚
â”‚                             â”‚
â”‚  æ¨¡å‹                       â”‚
â”‚  [qwen/qwen3-235b-a22b â–¼]   â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**2. WiFi ç®¡ç†**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å·²ä¿å­˜çš„ç½‘ç»œ                â”‚
â”‚  âœ“ HomeWiFi (å·²è¿æ¥)         â”‚
â”‚    OfficeWiFi                â”‚
â”‚    CafeWiFi                  â”‚
â”‚                             â”‚
â”‚  [+ æ·»åŠ ç½‘ç»œ]                â”‚
â”‚                             â”‚
â”‚  æ“ä½œï¼š                      â”‚
â”‚  [è¿æ¥] [æ–­å¼€] [åˆ é™¤]        â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ·»åŠ ç½‘ç»œ**:

1. ç‚¹å‡» **æ·»åŠ ç½‘ç»œ**
2. è¾“å…¥ SSID
3. è¾“å…¥å¯†ç 
4. ç‚¹å‡» **ä¿å­˜**

**è¿æ¥ç½‘ç»œ**:

1. åœ¨åˆ—è¡¨ä¸­é€‰æ‹©ç½‘ç»œ
2. ç‚¹å‡» **è¿æ¥**
3. ç­‰å¾…è¿æ¥çŠ¶æ€æ›´æ–°

**åˆ é™¤ç½‘ç»œ**:

1. é€‰æ‹©è¦åˆ é™¤çš„ç½‘ç»œ
2. ç‚¹å‡» **åˆ é™¤**
3. ç¡®è®¤æ“ä½œ

**3. ç³»ç»Ÿä¿¡æ¯** (åªè¯»)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å›ºä»¶ç‰ˆæœ¬: v3.0              â”‚
â”‚  èŠ¯ç‰‡å‹å·: ESP32-S3          â”‚
â”‚  Flash: 16 MB               â”‚
â”‚  PSRAM: 8 MB                â”‚
â”‚  WiFi: 192.168.1.100        â”‚
â”‚  è¿è¡Œæ—¶é—´: 02:15:30          â”‚
â”‚  å†…å­˜ä½¿ç”¨: 45%               â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ä¿å­˜é…ç½®

1. ä¿®æ”¹å®Œè®¾ç½®åï¼Œç‚¹å‡»åº•éƒ¨çš„ **ä¿å­˜å¹¶åº”ç”¨**
2. è®¾å¤‡ä¼šï¼š
   - ä¿å­˜é…ç½®åˆ° Flash
   - é‡æ–°åˆå§‹åŒ– LLM ç®¡ç†å™¨
   - å¦‚æœæ›´æ”¹äº† WiFiï¼Œä¼šé‡æ–°è¿æ¥
3. æ˜¾ç¤ºä¿å­˜çŠ¶æ€é€šçŸ¥

### 4.5 å¯¹è¯å†å²ç®¡ç†

#### æŸ¥çœ‹å†å²

- æ‰€æœ‰å¯¹è¯è‡ªåŠ¨ä¿å­˜
- å‘ä¸Šæ»šåŠ¨æŸ¥çœ‹å†å²æ¶ˆæ¯
- æœ€å¤šä¿ç•™ 40 æ¡æ¶ˆæ¯ï¼ˆçº¦ 20 è½®å¯¹è¯ï¼‰

#### æ¸…é™¤å†å²

**ä¸ºä»€ä¹ˆæ¸…é™¤å†å²ï¼Ÿ**

- å¯¹è¯ä¸»é¢˜åˆ‡æ¢
- ä¸Šä¸‹æ–‡æ··ä¹±
- å‡å°‘ token æ¶ˆè€—

**æ“ä½œæ–¹æ³•**:

1. åœ¨è®¾ç½®é¢æ¿ä¸­æ‰¾åˆ° "å¯¹è¯å†å²"
2. ç‚¹å‡» **æ¸…é™¤å†å²**
3. ç¡®è®¤æ“ä½œ
4. æ‰€æœ‰å†å²æ¶ˆæ¯è¢«åˆ é™¤ï¼Œå¼€å§‹æ–°çš„å¯¹è¯

**æ³¨æ„**: æ¸…é™¤å†å²æ˜¯å…¨å±€çš„ï¼Œä¼šå½±å“ Web å’Œ USB Shell ä¸¤ä¸ªç•Œé¢ã€‚

### 4.6 é«˜çº§åŠŸèƒ½åŒºï¼ˆé«˜çº§æ¨¡å¼ï¼‰

#### GPIO æ§åˆ¶é¢æ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GPIO æ§åˆ¶                   â”‚
â”‚                             â”‚
â”‚  LED 1    [ OFF ] [ ON  ]   â”‚
â”‚  LED 2    [ OFF ] [ ON  ]   â”‚
â”‚  LED 3    [ OFF ] [ ON  ]   â”‚
â”‚  GPIO 1   [ OFF ] [ ON  ]   â”‚
â”‚  GPIO 2   [ OFF ] [ ON  ]   â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä½¿ç”¨æ–¹æ³•**:

1. ç‚¹å‡» **ON** æŒ‰é’®å¼€å¯ GPIO
2. ç‚¹å‡» **OFF** æŒ‰é’®å…³é—­ GPIO
3. çŠ¶æ€ä¼šå®æ—¶æ›´æ–°

**LLM æ§åˆ¶**:

åœ¨é«˜çº§æ¨¡å¼ä¸‹ï¼ŒAI å¯ä»¥è‡ªåŠ¨æ§åˆ¶ GPIOï¼š

```
User: æ‰“å¼€ LED 1
Bot: [è°ƒç”¨å·¥å…·] control_gpio
     å‚æ•°: {"gpio": "led1", "state": true}
     ç»“æœ: LED 1 å·²å¼€å¯
```

---

## 5. OLED ç•Œé¢æ“ä½œ

### 5.1 çŠ¶æ€æ˜¾ç¤ºå±å¹•

**é»˜è®¤å±å¹•**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Mode: Chat          â”‚ â† LLM æ¨¡å¼
â”‚Model: deepseek     â”‚ â† å½“å‰æ¨¡å‹ï¼ˆç®€ç§°ï¼‰
â”‚SSID: MyWiFi        â”‚ â† WiFi åç§°
â”‚IP: 192.168.1.100   â”‚ â† IP åœ°å€
â”‚Mem: 45% (280KB)    â”‚ â† å†…å­˜ä½¿ç”¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å­—æ®µè¯´æ˜**:

- **Mode**: Chat (èŠå¤©æ¨¡å¼) æˆ– Advanced (é«˜çº§æ¨¡å¼)
- **Model**: å½“å‰ä½¿ç”¨çš„ LLM æ¨¡å‹åç§°
- **SSID**: 
  - å·²è¿æ¥ï¼šæ˜¾ç¤º WiFi åç§°
  - æœªè¿æ¥ï¼šæ˜¾ç¤º "N/A"
- **IP**: 
  - å·²è¿æ¥ï¼šæ˜¾ç¤º IP åœ°å€
  - æœªè¿æ¥ï¼šæ˜¾ç¤º WiFi çŠ¶æ€ï¼ˆConnecting / Failedï¼‰
- **Mem**: 
  - ç™¾åˆ†æ¯”ï¼šå·²ä½¿ç”¨å†…å­˜å æ€» DRAM çš„ç™¾åˆ†æ¯”
  - KBï¼šå‰©ä½™å¯ç”¨å†…å­˜

**æ“ä½œ**:

- æŒ‰ **Button A (OK)** è¿›å…¥ä¸»èœå•

### 5.2 ä¸»èœå•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Main Menu           â”‚
â”‚                    â”‚
â”‚> WiFi Settings     â”‚ â† å½“å‰é€‰ä¸­
â”‚  System Info       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ“ä½œ**:

- **Button B (Up)**: å‘ä¸Šç§»åŠ¨é€‰é¡¹
- **Button C (Down)**: å‘ä¸‹ç§»åŠ¨é€‰é¡¹
- **Button A (OK)**: è¿›å…¥é€‰ä¸­çš„èœå•é¡¹

**èœå•é¡¹**:

1. **WiFi Settings**: è¿›å…¥ WiFi ç®¡ç†èœå•
2. **System Info**: è¿”å›çŠ¶æ€æ˜¾ç¤ºå±å¹•

### 5.3 WiFi ç®¡ç†èœå•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚WiFi Menu           â”‚
â”‚                    â”‚
â”‚> Disconnect        â”‚ â† å½“å‰é€‰ä¸­
â”‚  Connect Saved     â”‚
â”‚  Scan Networks     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**èœå•é¡¹**:

1. **Disconnect**: æ–­å¼€å½“å‰ WiFi è¿æ¥
2. **Connect Saved**: è¿æ¥åˆ°å·²ä¿å­˜çš„ç½‘ç»œ
3. **Scan Networks**: æ‰«æå¯ç”¨ç½‘ç»œï¼ˆåŠŸèƒ½æœªå®ç°ï¼‰

**æ“ä½œç¤ºä¾‹**:

**æ–­å¼€ WiFi**:

1. é€‰æ‹© **Disconnect**
2. æŒ‰ **Button A (OK)**
3. è®¾å¤‡æ–­å¼€è¿æ¥ï¼Œè¿”å›çŠ¶æ€å±å¹•
4. IP å­—æ®µæ˜¾ç¤º "WiFi: Idle"

**è¿æ¥å·²ä¿å­˜ç½‘ç»œ**:

1. é€‰æ‹© **Connect Saved**
2. æŒ‰ **Button A (OK)**
3. è¿›å…¥å·²ä¿å­˜ç½‘ç»œåˆ—è¡¨

### 5.4 å·²ä¿å­˜ç½‘ç»œåˆ—è¡¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Saved WiFi Networks â”‚
â”‚                    â”‚
â”‚> HomeWiFi          â”‚ â† å½“å‰é€‰ä¸­
â”‚  OfficeWiFi        â”‚
â”‚  CafeWiFi          â”‚
â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ“ä½œ**:

- **Button B/C**: æµè§ˆç½‘ç»œåˆ—è¡¨
- **Button A (OK)**: è¿æ¥é€‰ä¸­çš„ç½‘ç»œ

**è¿æ¥è¿‡ç¨‹**:

1. æŒ‰ **OK** ç¡®è®¤è¿æ¥
2. è¿”å›çŠ¶æ€å±å¹•
3. WiFi çŠ¶æ€æ˜¾ç¤ºä¸º "Connecting"
4. è¿æ¥æˆåŠŸåæ˜¾ç¤º IP åœ°å€
5. è¿æ¥å¤±è´¥åæ˜¾ç¤º "Failed"

**æ»šåŠ¨æ˜¾ç¤º**:

- å±å¹•æœ€å¤šæ˜¾ç¤º 4 ä¸ªç½‘ç»œ
- å¦‚æœç½‘ç»œè¶…è¿‡ 4 ä¸ªï¼Œä½¿ç”¨ **Up/Down** æŒ‰é”®æ»šåŠ¨åˆ—è¡¨

---

## 6. USB Shell äº¤äº’

### 6.1 åŠŸèƒ½æ¦‚è¿°

USB Shell å…è®¸æ‚¨é€šè¿‡è®¡ç®—æœºçš„ç»ˆç«¯ä¸ NOOX è®¾å¤‡è¿›è¡Œå‘½ä»¤è¡Œçº§åˆ«çš„äº¤äº’ï¼ŒåŒæ—¶é›†æˆäº† AI èƒ½åŠ›ã€‚

**æ ¸å¿ƒåŠŸèƒ½**:

1. **Shell å‘½ä»¤æ‰§è¡Œ**: åœ¨è®¡ç®—æœºä¸Šæ‰§è¡Œå‘½ä»¤
2. **AI å¯¹è¯**: ä¸ AI è¿›è¡Œè‡ªç„¶è¯­è¨€äº¤äº’
3. **æ— ç¼é›†æˆ**: Shell å‘½ä»¤å’Œ AI å›å¤åœ¨åŒä¸€ç»ˆç«¯æ˜¾ç¤º

### 6.2 ä¸»æœºä»£ç†ç¨‹åº

#### ä»€ä¹ˆæ˜¯ä¸»æœºä»£ç†ï¼Ÿ

ä¸»æœºä»£ç†æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨è®¡ç®—æœºä¸Šçš„åŸç”Ÿå¯æ‰§è¡Œç¨‹åºï¼ˆGo è¯­è¨€ç¼–å†™ï¼‰ï¼Œè´Ÿè´£ï¼š

- è¿æ¥ ESP32 çš„ CDC è™šæ‹Ÿä¸²å£
- è½¬å‘ç”¨æˆ·è¾“å…¥åˆ°è®¾å¤‡
- æ‰§è¡Œè®¾å¤‡è¯·æ±‚çš„ Shell å‘½ä»¤
- æ˜¾ç¤º AI å“åº”

#### å®‰è£…ä¸»æœºä»£ç†

**æ–¹æ³• 1ï¼šä»è®¾å¤‡è·å–**

1. è¿æ¥ NOOX è®¾å¤‡åˆ°è®¡ç®—æœº
2. è®¾å¤‡ä¼šæ˜¾ç¤ºä¸º U ç›˜ï¼ˆåç§°ï¼šNOOX Diskï¼‰
3. åœ¨ U ç›˜ä¸­æ‰¾åˆ°ä¸»æœºä»£ç†ç¨‹åºï¼š
   - Windows: `agent.exe`
   - macOS: `agent_mac`
   - Linux: `agent_linux`
4. å°†ç¨‹åºå¤åˆ¶åˆ°æ‚¨çš„è®¡ç®—æœº

**æ–¹æ³• 2ï¼šä»æºç ç¼–è¯‘**

```bash
cd host-agent
go build -o agent main.go
```

#### è¿è¡Œä¸»æœºä»£ç†

**Windows**:

```powershell
# åŒå‡»è¿è¡Œæˆ–åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ
.\agent.exe
```

**macOS / Linux**:

```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x agent_mac

# è¿è¡Œ
./agent_mac
```

**è‡ªåŠ¨å¯åŠ¨** (å®éªŒæ€§åŠŸèƒ½):

è®¾å¤‡å¯åŠ¨æ—¶ï¼Œä¼šé€šè¿‡ HID æ¨¡æ‹Ÿé”®ç›˜è‡ªåŠ¨è¿è¡Œä»£ç†ç¨‹åºï¼š

```
Win+R â†’ agent.exe --wifi-status=disconnected
```

### 6.3 ä½¿ç”¨ USB Shell

#### å¯åŠ¨ä¼šè¯

1. ç¡®ä¿è®¾å¤‡é€šè¿‡ USB è¿æ¥åˆ°è®¡ç®—æœº
2. è¿è¡Œä¸»æœºä»£ç†ç¨‹åº
3. ä»£ç†ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶è¿æ¥åˆ° ESP32 çš„ CDC ä¸²å£
4. æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯ï¼š

```
NOOX Host Agent starting...
Initial WiFi Status from ESP32: connected
Connected to ESP32 on /dev/ttyACM0
Performing initial device setup...
Link test successful!
Ready for input. Type your message or command:
```

#### å‘é€æ¶ˆæ¯

**è‡ªç„¶è¯­è¨€è¾“å…¥**:

```bash
> ä½ å¥½ï¼Œå¸®æˆ‘åˆ—å‡ºå½“å‰ç›®å½•çš„æ–‡ä»¶
```

**è®¾å¤‡å¤„ç†**:

```
[NOOX] æ­£åœ¨æ‰§è¡Œå‘½ä»¤: ls -la
[Shell Output]
total 48
drwxr-xr-x  12 user  staff   384 Oct 12 10:30 .
drwxr-xr-x   6 user  staff   192 Oct 10 15:20 ..
-rw-r--r--   1 user  staff  1234 Oct 12 09:45 config.json
...

[NOOX AI] å½“å‰ç›®å½•åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
- config.json
- index.html.gz
- ...
```

#### ç›´æ¥æ‰§è¡Œå‘½ä»¤

**è¯¢é—® AI æ‰§è¡Œå‘½ä»¤**:

```bash
> å¸®æˆ‘åˆ›å»ºä¸€ä¸ªåä¸º test.txt çš„æ–‡ä»¶
```

**AI å“åº”**:

```
[NOOX] æ­£åœ¨æ‰§è¡Œå‘½ä»¤: touch test.txt
[Shell Output] (å‘½ä»¤æˆåŠŸæ‰§è¡Œï¼Œæ— è¾“å‡º)

[NOOX AI] æ–‡ä»¶ test.txt å·²æˆåŠŸåˆ›å»ºã€‚
```

#### å¤šè½®å¯¹è¯

```bash
> åˆ›å»ºä¸€ä¸ªåä¸º data çš„ç›®å½•
[NOOX AI] ç›®å½•å·²åˆ›å»ºã€‚

> è¿›å…¥è¿™ä¸ªç›®å½•
[NOOX] æ­£åœ¨æ‰§è¡Œå‘½ä»¤: cd data
[NOOX AI] å·²è¿›å…¥ data ç›®å½•ã€‚

> åœ¨è¿™é‡Œåˆ›å»ºä¸€ä¸ª readme.txt æ–‡ä»¶
[NOOX] æ­£åœ¨æ‰§è¡Œå‘½ä»¤: touch readme.txt
[NOOX AI] æ–‡ä»¶å·²åˆ›å»ºã€‚

> åˆ—å‡ºå½“å‰ç›®å½•çš„æ–‡ä»¶
[NOOX] æ­£åœ¨æ‰§è¡Œå‘½ä»¤: ls
[Shell Output]
readme.txt

[NOOX AI] å½“å‰ç›®å½•åŒ…å« 1 ä¸ªæ–‡ä»¶ï¼šreadme.txt
```

### 6.4 é€šä¿¡åè®®

#### æ¶ˆæ¯æ ¼å¼

æ‰€æœ‰æ¶ˆæ¯ä¸º JSON æ ¼å¼ï¼Œä»¥æ¢è¡Œç¬¦ç»“å°¾ã€‚

**ç”¨æˆ·è¾“å…¥æ¶ˆæ¯** (ä¸»æœº â†’ ESP32):

```json
{
  "requestId": "uuid-user-1",
  "type": "userInput",
  "payload": "å¸®æˆ‘åˆ—å‡ºæ–‡ä»¶"
}
```

**Shell å‘½ä»¤è¯·æ±‚** (ESP32 â†’ ä¸»æœº):

```json
{
  "requestId": "uuid-shell-1",
  "type": "shellCommand",
  "payload": "ls -la"
}
```

**Shell æ‰§è¡Œç»“æœ** (ä¸»æœº â†’ ESP32):

```json
{
  "requestId": "uuid-shell-1",
  "type": "shellCommandResult",
  "status": "success",
  "payload": {
    "command": "ls -la",
    "stdout": "æ–‡ä»¶åˆ—è¡¨...",
    "stderr": "",
    "exitCode": 0
  }
}
```

**AI å“åº”** (ESP32 â†’ ä¸»æœº):

```json
{
  "requestId": "uuid-ai-1",
  "type": "aiResponse",
  "payload": "å½“å‰ç›®å½•åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š..."
}
```

### 6.5 é«˜çº§ç”¨æ³•

#### é“¾è·¯æµ‹è¯•

**ç›®çš„**: æµ‹è¯•è®¾å¤‡ä¸ä¸»æœºçš„é€šä¿¡æ˜¯å¦æ­£å¸¸

**æ“ä½œ**:

ä¸»æœºä»£ç†å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨å‘é€ linkTestï¼š

```json
{
  "requestId": "uuid-linktest-1",
  "type": "linkTest",
  "payload": "ping"
}
```

**è®¾å¤‡å“åº”**:

```json
{
  "requestId": "uuid-linktest-1",
  "type": "linkTestResult",
  "status": "success",
  "payload": "pong"
}
```

#### WiFi è‡ªåŠ¨é…ç½®

**åœºæ™¯**: è®¾å¤‡æœªè¿æ¥ WiFi æ—¶ï¼Œä¸»æœºä»£ç†å°è¯•è·å–ä¸»æœº WiFi ä¿¡æ¯å¹¶å‘é€ç»™è®¾å¤‡ã€‚

**æµç¨‹**:

1. è®¾å¤‡å¯åŠ¨æ—¶ä¼ é€’ WiFi çŠ¶æ€ç»™ä»£ç†ï¼š
   ```
   agent.exe --wifi-status=disconnected
   ```

2. ä»£ç†æ£€æµ‹åˆ° `disconnected`ï¼Œè·å–ä¸»æœº WiFi ä¿¡æ¯

3. å‘é€è¿æ¥è¯·æ±‚ï¼š
   ```json
   {
     "requestId": "uuid-wifi-1",
     "type": "connectToWifi",
     "payload": {
       "ssid": "MyHomeWiFi",
       "password": "MyPassword"
     }
   }
   ```

4. è®¾å¤‡è¿æ¥ WiFi å¹¶å“åº”ï¼š
   ```json
   {
     "requestId": "uuid-wifi-1",
     "type": "wifiConnectStatus",
     "status": "success",
     "payload": "Connected to MyHomeWiFi"
   }
   ```

---

## 7. LLM åŠŸèƒ½è¯¦è§£

### 7.1 æ”¯æŒçš„æä¾›å•†

#### DeepSeek

**å®˜ç½‘**: https://platform.deepseek.com

**ç‰¹ç‚¹**:
- âœ… å…è´¹é¢åº¦ï¼š200ä¸‡ tokens/å¤©
- âœ… ä¸­æ–‡æ”¯æŒä¼˜ç§€
- âœ… æ¨ç†èƒ½åŠ›å¼º
- âš¡ å“åº”é€Ÿåº¦å¿«

**æ¨èæ¨¡å‹**:
- `deepseek-chat`: é€šç”¨å¯¹è¯æ¨¡å‹
- `deepseek-reasoner`: æ·±åº¦æ¨ç†æ¨¡å‹

**è·å– API Key**:

1. æ³¨å†Œè´¦å·
2. è¿›å…¥ [API Keys](https://platform.deepseek.com/api_keys) é¡µé¢
3. ç‚¹å‡» "åˆ›å»º API Key"
4. å¤åˆ¶å¯†é’¥ï¼ˆæ ¼å¼ï¼š`sk-xxxxxx`ï¼‰

#### OpenRouter

**å®˜ç½‘**: https://openrouter.ai

**ç‰¹ç‚¹**:
- âœ… èšåˆå¤šç§æ¨¡å‹ï¼ˆDeepSeek, Qwen, Gemini ç­‰ï¼‰
- âœ… éƒ¨åˆ†æ¨¡å‹å…è´¹
- âœ… ç»Ÿä¸€ API æ¥å£
- ğŸŒ å›½é™…åŒ–æ”¯æŒ

**æ¨èå…è´¹æ¨¡å‹**:
- `z-ai/glm-4.5-air:free`: æ™ºè°± AI å…è´¹æ¨¡å‹
- `qwen/qwen3-235b-a22b:free`: é€šä¹‰åƒé—®å…è´¹æ¨¡å‹
- `deepseek/deepseek-chat-v3.1:free`: DeepSeek å…è´¹ç‰ˆæœ¬

**è·å– API Key**:

1. æ³¨å†Œè´¦å·
2. è¿›å…¥ [Keys](https://openrouter.ai/keys) é¡µé¢
3. åˆ›å»ºæ–°å¯†é’¥
4. å¤åˆ¶å¯†é’¥ï¼ˆæ ¼å¼ï¼š`sk-or-v1-xxxxxx`ï¼‰

#### OpenAI

**å®˜ç½‘**: https://platform.openai.com

**ç‰¹ç‚¹**:
- ğŸ† æœ€å¼ºå¤§çš„æ¨¡å‹
- ğŸŒ å…¨çƒä½¿ç”¨æœ€å¹¿
- ğŸ’° å®Œå…¨ä»˜è´¹ï¼ˆæ— å…è´¹é¢åº¦ï¼‰
- ğŸš€ æŒç»­æ›´æ–°

**æ¨èæ¨¡å‹**:
- `gpt-4o`: GPT-4 ç³»åˆ—æœ€æ–°ç‰ˆæœ¬
- `gpt-3.5-turbo`: æ€§ä»·æ¯”é«˜

**è·å– API Key**:

1. æ³¨å†Œè´¦å·ï¼ˆéœ€è¦å›½é™…ä¿¡ç”¨å¡ï¼‰
2. è¿›å…¥ [API Keys](https://platform.openai.com/api-keys) é¡µé¢
3. åˆ›å»ºæ–°å¯†é’¥
4. å¤åˆ¶å¯†é’¥ï¼ˆæ ¼å¼ï¼š`sk-xxxxxx`ï¼‰

### 7.2 æ¨¡å¼å¯¹æ¯”

| ç‰¹æ€§ | èŠå¤©æ¨¡å¼ (Chat) | é«˜çº§æ¨¡å¼ (Advanced) |
|------|-----------------|---------------------|
| **ç”¨é€”** | æ—¥å¸¸å¯¹è¯ã€çŸ¥è¯†é—®ç­” | ç³»ç»Ÿè‡ªåŠ¨åŒ–ã€ä»»åŠ¡æ‰§è¡Œ |
| **å·¥å…·è°ƒç”¨** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| **å“åº”é€Ÿåº¦** | å¿«ï¼ˆ2-5 ç§’ï¼‰ | æ…¢ï¼ˆ5-15 ç§’ï¼‰ |
| **Token æ¶ˆè€—** | ä½ | é«˜ |
| **ç³»ç»Ÿæç¤ºè¯** | ç®€å•å‹å¥½ | è¯¦ç»†å·¥å…·æè¿° |
| **é€‚ç”¨åœºæ™¯** | é—²èŠã€å’¨è¯¢ã€åˆ›ä½œ | å‘½ä»¤æ‰§è¡Œã€è®¾å¤‡æ§åˆ¶ |

### 7.3 å·¥å…·è°ƒç”¨æœºåˆ¶

#### ä»€ä¹ˆæ˜¯å·¥å…·è°ƒç”¨ï¼Ÿ

å·¥å…·è°ƒç”¨ï¼ˆFunction Callingï¼‰æ˜¯ LLM çš„ä¸€ç§èƒ½åŠ›ï¼Œå…è®¸ AI è°ƒç”¨é¢„å®šä¹‰çš„å‡½æ•°æ¥å®Œæˆä»»åŠ¡ã€‚

**æµç¨‹**:

```
ç”¨æˆ·: "å¸®æˆ‘æ‰“å¼€è®°äº‹æœ¬"
    â†“
LLM åˆ†ææ„å›¾ â†’ éœ€è¦è°ƒç”¨ control_keyboard å·¥å…·
    â†“
LLM è¿”å›å·¥å…·è°ƒç”¨ï¼š
{
  "tool": "control_keyboard",
  "args": {
    "action": "press",
    "value": "Win+R"
  }
}
    â†“
è®¾å¤‡æ‰§è¡Œå·¥å…· â†’ æ¨¡æ‹ŸæŒ‰é”® Win+R
    â†“
è®¾å¤‡è¿”å›æ‰§è¡Œç»“æœ â†’ "è¿è¡Œå¯¹è¯æ¡†å·²æ‰“å¼€"
    â†“
LLM ç»§ç»­è°ƒç”¨å·¥å…·è¾“å…¥ "notepad" å¹¶å›è½¦
    â†“
è®¾å¤‡è¿”å› â†’ "è®°äº‹æœ¬å·²æ‰“å¼€"
    â†“
LLM æœ€ç»ˆå›å¤: "è®°äº‹æœ¬å·²æˆåŠŸæ‰“å¼€ã€‚"
```

#### å¯ç”¨å·¥å…·

##### 1. execute_shell_command

**æè¿°**: åœ¨ç”¨æˆ·è®¡ç®—æœºä¸Šæ‰§è¡Œ Shell å‘½ä»¤

**å‚æ•°**:

```json
{
  "command": "è¦æ‰§è¡Œçš„å‘½ä»¤"
}
```

**ç¤ºä¾‹**:

```json
{
  "tool": "execute_shell_command",
  "args": {
    "command": "ls -la"
  }
}
```

**é€‚ç”¨åœºæ™¯**:
- æ–‡ä»¶ç®¡ç†ï¼ˆåˆ›å»ºã€åˆ é™¤ã€ç§»åŠ¨ã€å¤åˆ¶ï¼‰
- ç³»ç»Ÿä¿¡æ¯æŸ¥è¯¢ï¼ˆç£ç›˜ä½¿ç”¨ã€è¿›ç¨‹åˆ—è¡¨ï¼‰
- è½¯ä»¶å®‰è£…å’Œé…ç½®
- æ‰¹é‡æ“ä½œ

##### 2. control_keyboard

**æè¿°**: æ¨¡æ‹Ÿé”®ç›˜è¾“å…¥æ–‡æœ¬æˆ–æŒ‰é”®ç»„åˆ

**å‚æ•°**:

```json
{
  "action": "type | press",
  "value": "æ–‡æœ¬å†…å®¹æˆ–æŒ‰é”®ç»„åˆ"
}
```

**ç¤ºä¾‹**:

**è¾“å…¥æ–‡æœ¬**:

```json
{
  "tool": "control_keyboard",
  "args": {
    "action": "type",
    "value": "Hello, World!"
  }
}
```

**æŒ‰é”®ç»„åˆ**:

```json
{
  "tool": "control_keyboard",
  "args": {
    "action": "press",
    "value": "Ctrl+C"
  }
}
```

**æ”¯æŒçš„æŒ‰é”®**:
- ä¿®é¥°é”®ï¼šCtrl, Shift, Alt, Win (Cmd on macOS)
- åŠŸèƒ½é”®ï¼šF1-F12
- å¯¼èˆªé”®ï¼šHome, End, PageUp, PageDown
- æ–¹å‘é”®ï¼šUp, Down, Left, Right
- ç‰¹æ®Šé”®ï¼šEnter, Tab, Backspace, Escape, Space

**é€‚ç”¨åœºæ™¯**:
- æ‰“å¼€åº”ç”¨ç¨‹åºï¼ˆWin+Rï¼‰
- å¤åˆ¶ç²˜è´´æ“ä½œ
- å¿«æ·é”®è§¦å‘
- è‡ªåŠ¨åŒ–æ–‡æœ¬è¾“å…¥

##### 3. control_gpio

**æè¿°**: æ§åˆ¶ ESP32 çš„ GPIO è¾“å‡ºçŠ¶æ€

**å‚æ•°**:

```json
{
  "gpio": "led1 | led2 | led3 | gpio1 | gpio2",
  "state": true | false
}
```

**ç¤ºä¾‹**:

```json
{
  "tool": "control_gpio",
  "args": {
    "gpio": "led1",
    "state": true
  }
}
```

**é€‚ç”¨åœºæ™¯**:
- è¿œç¨‹æ§åˆ¶è®¾å¤‡æŒ‡ç¤ºç¯
- è§¦å‘å¤–éƒ¨ç»§ç”µå™¨
- æ§åˆ¶è‡ªå®šä¹‰ç¡¬ä»¶

### 7.4 å¯¹è¯å†å²

#### åŠŸèƒ½è¯´æ˜

NOOX ä¼šè‡ªåŠ¨ä¿å­˜æœ€è¿‘çš„å¯¹è¯å†…å®¹ï¼Œä½¿ AI èƒ½å¤Ÿè®°ä½ä¸Šä¸‹æ–‡ï¼Œå®ç°å¤šè½®å¯¹è¯ã€‚

**å®¹é‡**: 40 æ¡æ¶ˆæ¯ï¼ˆçº¦ 20 è½®å¯¹è¯ï¼‰

**å­˜å‚¨ä½ç½®**: PSRAMï¼ˆä¸å ç”¨ DRAMï¼‰

**å…±äº«æ€§**: Web ç•Œé¢å’Œ USB Shell å…±äº«åŒä¸€å†å²è®°å½•

#### ç¤ºä¾‹

**æœ‰å†å²è®°å½•**:

```
User: ä½ å–œæ¬¢é»‘å¡å—ï¼Ÿ
AI: æ˜¯çš„ï¼Œèµ«å°”æ›¼Â·é»‘å¡æ˜¯ä¸€ä½ä¼Ÿå¤§çš„å¾·å›½ä½œå®¶...

User: è®²è®²ä»–çš„ä½œå“
AI: é»‘å¡çš„ä»£è¡¨ä½œå“åŒ…æ‹¬ã€Šæ‚‰è¾¾å¤šã€‹ã€ã€Šè’åŸç‹¼ã€‹...  â† AI çŸ¥é“"ä»–"æŒ‡é»‘å¡
```

**æ— å†å²è®°å½•**:

```
User: ä½ å–œæ¬¢é»‘å¡å—ï¼Ÿ
AI: æ˜¯çš„ï¼Œèµ«å°”æ›¼Â·é»‘å¡æ˜¯ä¸€ä½ä¼Ÿå¤§çš„å¾·å›½ä½œå®¶...

[æ¸…é™¤å†å²]

User: è®²è®²ä»–çš„ä½œå“
AI: è¯·é—®æ‚¨æƒ³äº†è§£å“ªä½ä½œå®¶çš„ä½œå“ï¼Ÿ  â† AI ä¸çŸ¥é“"ä»–"æ˜¯è°
```

#### æ¸…é™¤å†å²

**è§¦å‘æ—¶æœº**:
- å¯¹è¯ä¸»é¢˜åˆ‡æ¢
- ä¸Šä¸‹æ–‡æ··ä¹±
- å¸Œæœ›å‡å°‘ token æ¶ˆè€—

**æ“ä½œæ–¹æ³•**:

**Web ç•Œé¢**:

1. è¿›å…¥è®¾ç½®é¢æ¿
2. æ‰¾åˆ° "å¯¹è¯å†å²" éƒ¨åˆ†
3. ç‚¹å‡» **æ¸…é™¤å†å²**
4. ç¡®è®¤æ“ä½œ

**WebSocket å‘½ä»¤**:

```json
{
  "type": "clear_history"
}
```

**æ•ˆæœ**: æ‰€æœ‰å†å²æ¶ˆæ¯è¢«åˆ é™¤ï¼Œä¸‹ä¸€æ¬¡å¯¹è¯å°†ä¸åŒ…å«ä»»ä½•ä¸Šä¸‹æ–‡ã€‚

### 7.5 æ€§èƒ½ä¼˜åŒ–

#### Token ä¼˜åŒ–

**ä»€ä¹ˆæ˜¯ Tokenï¼Ÿ**

Token æ˜¯ LLM å¤„ç†æ–‡æœ¬çš„åŸºæœ¬å•ä½ï¼Œçº¦ç­‰äº 0.75 ä¸ªè‹±æ–‡å•è¯æˆ– 1.5 ä¸ªä¸­æ–‡å­—ç¬¦ã€‚

**Token è®¡ç®—**:

```
"Hello World" â‰ˆ 2 tokens
"ä½ å¥½ä¸–ç•Œ" â‰ˆ 4 tokens
```

**ä¼˜åŒ–å»ºè®®**:

1. **æ¸…é™¤æ— å…³å†å²**: å®šæœŸæ¸…é™¤å¯¹è¯å†å²
2. **ä½¿ç”¨ç®€æ´æé—®**: é¿å…å†—é•¿æè¿°
3. **é€‰æ‹©åˆé€‚æ¨¡å‹**: 
   - ç®€å•ä»»åŠ¡ï¼šdeepseek-chat
   - å¤æ‚æ¨ç†ï¼šdeepseek-reasoner

#### å“åº”æ—¶é—´ä¼˜åŒ–

| å› ç´  | å½±å“ | ä¼˜åŒ–æ–¹æ³• |
|------|------|----------|
| **ç½‘ç»œå»¶è¿Ÿ** | ä¸­ | ä½¿ç”¨ç¨³å®šçš„ WiFiï¼Œé€‰æ‹©åœ°ç†ä½ç½®è¿‘çš„æä¾›å•† |
| **æ¨¡å‹å¤§å°** | é«˜ | å°æ¨¡å‹å“åº”æ›´å¿«ï¼ˆå¦‚ deepseek-chatï¼‰ |
| **å¯¹è¯å†å²é•¿åº¦** | ä¸­ | å®šæœŸæ¸…é™¤å†å² |
| **å·¥å…·è°ƒç”¨æ¬¡æ•°** | é«˜ | é«˜çº§æ¨¡å¼ä¸‹ï¼Œå¤æ‚ä»»åŠ¡å¯èƒ½éœ€è¦å¤šæ¬¡è°ƒç”¨ |

#### å†…å­˜ç®¡ç†

**DRAM ä½¿ç”¨**:

- ç©ºé—²ï¼š~80 KB
- LLM è°ƒç”¨ï¼š~180 KB
- å³°å€¼ï¼š~200 KB

**PSRAM ä½¿ç”¨**:

- å¯¹è¯å†å²ï¼š~100 KB
- LLM å“åº”ç¼“å†²ï¼š~300 KB
- å³°å€¼ï¼š~350 KB

**ç›‘æ§å†…å­˜**:

OLED æ˜¾ç¤ºå±å®æ—¶æ˜¾ç¤ºå†…å­˜ä½¿ç”¨æƒ…å†µï¼š

```
Mem: 45% (280KB)
     â†‘        â†‘
  å·²ä½¿ç”¨%  å‰©ä½™DRAM
```

**å†…å­˜ä¸è¶³ç—‡çŠ¶**:
- è®¾å¤‡é¢‘ç¹é‡å¯
- LLM è°ƒç”¨å¤±è´¥
- å“åº”å»¶è¿Ÿå¢åŠ 

**è§£å†³æ–¹æ³•**:
- æ¸…é™¤å¯¹è¯å†å²
- é‡å¯è®¾å¤‡
- å‡å°‘å¹¶å‘ WebSocket è¿æ¥

---

## 8. é«˜çº§åŠŸèƒ½

### 8.1 è‡ªå®šä¹‰ç³»ç»Ÿæç¤ºè¯

#### ä»€ä¹ˆæ˜¯ç³»ç»Ÿæç¤ºè¯ï¼Ÿ

ç³»ç»Ÿæç¤ºè¯æ˜¯å‘é€ç»™ LLM çš„é¦–æ¡æ¶ˆæ¯ï¼Œç”¨äºå®šä¹‰ AI çš„è§’è‰²ã€è¡Œä¸ºå’Œèƒ½åŠ›ã€‚

**é»˜è®¤ç³»ç»Ÿæç¤ºè¯**:

**èŠå¤©æ¨¡å¼**:

```
ä½ æ˜¯ä¸€ä¸ªå‹å–„ã€çƒ­æƒ…ã€ä¹äºåŠ©äººçš„AIåŠ©æ‰‹ã€‚
è¯·ç”¨ç®€æ´ã€è‡ªç„¶çš„è¯­è¨€å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚
```

**é«˜çº§æ¨¡å¼**:

```
ä½ æ˜¯ä¸€ä¸ªé«˜çº§AIåŠ©æ‰‹ï¼Œèƒ½å¤Ÿè°ƒç”¨ä»¥ä¸‹å·¥å…·æ¥å®Œæˆä»»åŠ¡ï¼š

## å·¥å…·ï¼šexecute_shell_command
æè¿°ï¼šåœ¨ç”¨æˆ·çš„è®¡ç®—æœºä¸Šæ‰§è¡Œ Shell å‘½ä»¤
å‚æ•°ï¼š{ "command": "è¦æ‰§è¡Œçš„å‘½ä»¤" }
ä½¿ç”¨æ—¶æœºï¼šå½“ç”¨æˆ·è¦æ±‚æ“ä½œæ–‡ä»¶ã€æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ã€è¿è¡Œç¨‹åºæ—¶

## å·¥å…·ï¼šcontrol_keyboard
æè¿°ï¼šæ¨¡æ‹Ÿé”®ç›˜æŒ‰é”®ï¼Œè¾“å…¥æ–‡æœ¬æˆ–å¿«æ·é”®
å‚æ•°ï¼š{ "action": "type|press", "value": "å†…å®¹æˆ–æŒ‰é”®ç»„åˆ" }
ç¤ºä¾‹ï¼š{ "action": "press", "value": "Ctrl+C" }
ä½¿ç”¨æ—¶æœºï¼šå½“ç”¨æˆ·è¦æ±‚æ‰“å¼€åº”ç”¨ã€å¤åˆ¶ç²˜è´´ã€è§¦å‘å¿«æ·é”®æ—¶

## å·¥å…·ï¼šcontrol_gpio
æè¿°ï¼šæ§åˆ¶ESP32çš„GPIOè¾“å‡ºçŠ¶æ€
å‚æ•°ï¼š{ "gpio": "led1|led2|led3|gpio1|gpio2", "state": true|false }
ä½¿ç”¨æ—¶æœºï¼šå½“ç”¨æˆ·è¦æ±‚æ§åˆ¶è®¾å¤‡æŒ‡ç¤ºç¯æˆ–GPIOæ—¶

è¯·æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚ï¼Œæ™ºèƒ½é€‰æ‹©åˆé€‚çš„å·¥å…·æ¥å®Œæˆä»»åŠ¡ã€‚
```

#### è‡ªå®šä¹‰æç¤ºè¯

**ä¿®æ”¹ä½ç½®**: `src/llm_manager.cpp`

**å‡½æ•°**: `LLMManager::generateSystemPrompt(LLMMode mode)`

**ç¤ºä¾‹**:

```cpp
String LLMManager::generateSystemPrompt(LLMMode mode) {
    if (mode == CHAT_MODE) {
        // è‡ªå®šä¹‰èŠå¤©æ¨¡å¼æç¤ºè¯
        return "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æŠ€æœ¯é¡¾é—®ï¼Œæ“…é•¿è§£ç­”ç¼–ç¨‹å’Œç¡¬ä»¶ç›¸å…³é—®é¢˜ã€‚"
               "è¯·ç”¨ä¸“ä¸šä½†æ˜“æ‡‚çš„è¯­è¨€å›ç­”ï¼Œå¿…è¦æ—¶æä¾›ä»£ç ç¤ºä¾‹ã€‚";
    } else {
        // è‡ªå®šä¹‰é«˜çº§æ¨¡å¼æç¤ºè¯
        String prompt = "ä½ æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–ä¸“å®¶ï¼Œèƒ½å¤Ÿä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š\n\n";
        // ... æ·»åŠ å·¥å…·æè¿°
        return prompt;
    }
}
```

**é‡æ–°ç¼–è¯‘**:

```bash
pio run --target upload
```

### 8.2 æ·»åŠ æ–°å·¥å…·

#### æ­¥éª¤ 1ï¼šå®šä¹‰å·¥å…·å‡½æ•°

åœ¨ `src/llm_manager.cpp` çš„ `handleLLMRawResponse()` å‡½æ•°ä¸­æ·»åŠ å·¥å…·å¤„ç†é€»è¾‘ã€‚

**ç¤ºä¾‹ï¼šæ·»åŠ  "control_mouse" å·¥å…·**

```cpp
void LLMManager::handleLLMRawResponse(const String& requestId, const String& prompt, const String& llmContentString) {
    // ... ç°æœ‰ä»£ç 
    
    if (toolName == "control_mouse") {
        // è§£æå‚æ•°
        String action = toolCallObj["arguments"]["action"] | "";
        int x = toolCallObj["arguments"]["x"] | 0;
        int y = toolCallObj["arguments"]["y"] | 0;
        int button = toolCallObj["arguments"]["button"] | 1;
        
        // æ‰§è¡Œå·¥å…·
        if (action == "move") {
            _hidManager->moveMouse(x, y);
            toolResult = "é¼ æ ‡å·²ç§»åŠ¨åˆ° (" + String(x) + ", " + String(y) + ")";
        } else if (action == "click") {
            _hidManager->clickMouse(button);
            toolResult = "é¼ æ ‡å·²ç‚¹å‡»æŒ‰é’® " + String(button);
        }
        
        // è®°å½•æ—¥å¿—
        Serial.printf("Tool: control_mouse, Result: %s\n", toolResult.c_str());
    }
    
    // ... å…¶ä»–å·¥å…·
}
```

#### æ­¥éª¤ 2ï¼šæ·»åŠ å·¥å…·æè¿°

åœ¨ `generateSystemPrompt()` å‡½æ•°ä¸­æ·»åŠ å·¥å…·æè¿°ï¼š

```cpp
String prompt = "ä½ æ˜¯ä¸€ä¸ªé«˜çº§AIåŠ©æ‰‹ï¼Œèƒ½å¤Ÿè°ƒç”¨ä»¥ä¸‹å·¥å…·ï¼š\n\n";

// ... ç°æœ‰å·¥å…·

prompt += "## å·¥å…·ï¼šcontrol_mouse\n";
prompt += "æè¿°ï¼šæ§åˆ¶é¼ æ ‡ç§»åŠ¨å’Œç‚¹å‡»\n";
prompt += "å‚æ•°ï¼š\n";
prompt += "  - action: \"move\" æˆ– \"click\"\n";
prompt += "  - x, y: é¼ æ ‡åæ ‡ï¼ˆå½“ action=move æ—¶ï¼‰\n";
prompt += "  - button: é¼ æ ‡æŒ‰é’®ï¼ˆ1=å·¦é”®, 2=å³é”®, 3=ä¸­é”®ï¼Œå½“ action=click æ—¶ï¼‰\n";
prompt += "ä½¿ç”¨æ—¶æœºï¼šå½“ç”¨æˆ·è¦æ±‚ç§»åŠ¨é¼ æ ‡æˆ–ç‚¹å‡»æ—¶\n\n";
```

#### æ­¥éª¤ 3ï¼šæµ‹è¯•

1. é‡æ–°ç¼–è¯‘å¹¶ä¸Šä¼ å›ºä»¶
2. åˆ‡æ¢åˆ°é«˜çº§æ¨¡å¼
3. å‘é€æµ‹è¯•æ¶ˆæ¯ï¼š

```
User: ç§»åŠ¨é¼ æ ‡åˆ°åæ ‡ (100, 200)
AI: [è°ƒç”¨å·¥å…·] control_mouse
     å‚æ•°: {"action": "move", "x": 100, "y": 200}
     ç»“æœ: é¼ æ ‡å·²ç§»åŠ¨åˆ° (100, 200)
```

### 8.3 é›†æˆå¤–éƒ¨ä¼ æ„Ÿå™¨

#### ç¤ºä¾‹ï¼šè¿æ¥ DHT22 æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨

**ç¡¬ä»¶è¿æ¥**:

| DHT22 å¼•è„š | ESP32 å¼•è„š |
|------------|------------|
| VCC | 3.3V |
| GND | GND |
| DATA | GPIO8 |

**è½¯ä»¶é›†æˆ**:

**1. å®‰è£…åº“**:

ç¼–è¾‘ `platformio.ini`ï¼š

```ini
lib_deps =
  ...
  adafruit/DHT sensor library@^1.4.4
  adafruit/Adafruit Unified Sensor@^1.1.7
```

**2. ä¿®æ”¹ä»£ç **:

åœ¨ `src/main.cpp` ä¸­æ·»åŠ ï¼š

```cpp
#include <DHT.h>

#define DHTPIN GPIO8
#define DHTTYPE DHT22
DHT dht(DHTPIN, DHTTYPE);

void setup() {
    // ... ç°æœ‰ä»£ç 
    dht.begin();
}

void loop() {
    // ... ç°æœ‰ä»£ç 
    
    // æ¯ 10 ç§’è¯»å–ä¸€æ¬¡
    static unsigned long lastRead = 0;
    if (millis() - lastRead > 10000) {
        float temp = dht.readTemperature();
        float humidity = dht.readHumidity();
        
        Serial.printf("Temperature: %.1fÂ°C, Humidity: %.1f%%\n", temp, humidity);
        
        lastRead = millis();
    }
}
```

**3. æ·»åŠ  LLM å·¥å…·**:

åœ¨ `llm_manager.cpp` ä¸­æ·»åŠ  `get_temperature` å·¥å…·ï¼š

```cpp
if (toolName == "get_temperature") {
    float temp = dht.readTemperature();
    float humidity = dht.readHumidity();
    
    toolResult = "å½“å‰æ¸©åº¦: " + String(temp, 1) + "Â°C, æ¹¿åº¦: " + String(humidity, 1) + "%";
}
```

**4. æµ‹è¯•**:

```
User: ç°åœ¨çš„æ¸©åº¦æ˜¯å¤šå°‘ï¼Ÿ
AI: [è°ƒç”¨å·¥å…·] get_temperature
     ç»“æœ: å½“å‰æ¸©åº¦: 24.5Â°C, æ¹¿åº¦: 55.3%
```

### 8.4 OTA å›ºä»¶æ›´æ–°

#### ä»€ä¹ˆæ˜¯ OTAï¼Ÿ

OTA (Over-The-Air) æ˜¯ä¸€ç§æ— éœ€ USB è¿æ¥å³å¯æ›´æ–°å›ºä»¶çš„æŠ€æœ¯ã€‚

#### å¯ç”¨ OTA

**æ–¹æ³• 1ï¼šé€šè¿‡ Web ç•Œé¢** (éœ€è¦å¼€å‘)

1. è®¿é—® Web æ§åˆ¶å°
2. è¿›å…¥è®¾ç½® â†’ ç³»ç»Ÿæ›´æ–°
3. é€‰æ‹©å›ºä»¶æ–‡ä»¶ (.bin)
4. ç‚¹å‡»ä¸Šä¼ å¹¶æ›´æ–°

**æ–¹æ³• 2ï¼šé€šè¿‡ PlatformIO**

```bash
# è®¾ç½® OTA å¯†ç ï¼ˆå¯é€‰ï¼‰
export OTA_PASSWORD="your_password"

# OTA ä¸Šä¼ 
pio run --target upload --upload-port 192.168.1.100
```

**é…ç½® `platformio.ini`**:

```ini
upload_protocol = espota
upload_port = 192.168.1.100
upload_flags =
  --auth=your_password
```

#### OTA æ›´æ–°æµç¨‹

```
1. è®¾å¤‡è¿è¡Œåœ¨ app0 åˆ†åŒº
2. OTA æ–°å›ºä»¶å†™å…¥ app1 åˆ†åŒº
3. éªŒè¯ app1 åˆ†åŒºå®Œæ•´æ€§
4. æ ‡è®° app1 ä¸ºå¯åŠ¨åˆ†åŒº
5. é‡å¯è®¾å¤‡
6. ä» app1 å¯åŠ¨æ–°å›ºä»¶
7. å¦‚æœå¯åŠ¨å¤±è´¥ï¼Œè‡ªåŠ¨å›æ»šåˆ° app0
```

---

## 9. æ•…éšœæ’é™¤

### 9.1 WiFi è¿æ¥é—®é¢˜

#### é—®é¢˜ï¼šè®¾å¤‡æ— æ³•è¿æ¥ WiFi

**ç—‡çŠ¶**:
- OLED æ˜¾ç¤º "WiFi: Failed"
- ä¸²å£è¾“å‡º "WiFi connection timed out"

**å¯èƒ½åŸå› **:

1. **SSID æˆ–å¯†ç é”™è¯¯**
   - æ£€æŸ¥ `config.json` ä¸­çš„ WiFi é…ç½®
   - æ³¨æ„åŒºåˆ†å¤§å°å†™

2. **è·¯ç”±å™¨ä»…æ”¯æŒ 5GHz**
   - ESP32-S3 ä»…æ”¯æŒ 2.4GHz WiFi
   - ç¡®è®¤è·¯ç”±å™¨å·²å¯ç”¨ 2.4GHz é¢‘æ®µ

3. **WiFi ä¿¡å·å¼±**
   - å°†è®¾å¤‡é è¿‘è·¯ç”±å™¨
   - æ£€æŸ¥è·¯ç”±å™¨å¤©çº¿

4. **è·¯ç”±å™¨ MAC åœ°å€è¿‡æ»¤**
   - æŸ¥çœ‹è®¾å¤‡ MAC åœ°å€ï¼ˆä¸²å£è¾“å‡ºï¼‰
   - å°† MAC åœ°å€æ·»åŠ åˆ°è·¯ç”±å™¨ç™½åå•

**è§£å†³æ–¹æ³•**:

```bash
# é€šè¿‡ä¸²å£ç›‘è§†å™¨æ£€æŸ¥æ—¥å¿—
pio device monitor

# æ£€æŸ¥è¿æ¥çŠ¶æ€
WiFi.begin(ssid, password);
// è§‚å¯Ÿä¸²å£è¾“å‡º
```

#### é—®é¢˜ï¼šè¿æ¥åé¢‘ç¹æ–­çº¿

**ç—‡çŠ¶**:
- OLED æ˜¾ç¤º IP åœ°å€ååˆå˜ä¸º "Connecting"
- ä¸²å£è¾“å‡º "WiFi connection lost"

**å¯èƒ½åŸå› **:

1. **è·¯ç”±å™¨è´Ÿè½½è¿‡é«˜**
   - å‡å°‘åŒæ—¶è¿æ¥çš„è®¾å¤‡æ•°é‡

2. **çœç”µæ¨¡å¼å†²çª**
   - WiFi çœç”µæ¨¡å¼å¯èƒ½å¯¼è‡´æ–­è¿

**è§£å†³æ–¹æ³•**:

åœ¨ `src/wifi_manager.cpp` ä¸­ç¦ç”¨çœç”µæ¨¡å¼ï¼š

```cpp
void AppWiFiManager::begin() {
    WiFi.mode(WIFI_STA);
    WiFi.setSleep(false);  // ç¦ç”¨ WiFi çœç”µ
    connectToLastSSID();
}
```

### 9.2 LLM API è°ƒç”¨å¤±è´¥

#### é—®é¢˜ï¼šAPI è°ƒç”¨è¶…æ—¶

**ç—‡çŠ¶**:
- Web ç•Œé¢é•¿æ—¶é—´æ— å“åº”
- ä¸²å£è¾“å‡º "HTTPS request timeout"

**å¯èƒ½åŸå› **:

1. **ç½‘ç»œå»¶è¿Ÿé«˜**
   - æµ‹è¯•ç½‘ç»œé€Ÿåº¦ï¼š`ping api.deepseek.com`
   
2. **API ç«¯ç‚¹æ— æ³•è®¿é—®**
   - å°è¯•åœ¨æµè§ˆå™¨è®¿é—® API ç«¯ç‚¹
   
3. **é˜²ç«å¢™é˜»æ­¢**
   - æ£€æŸ¥è·¯ç”±å™¨é˜²ç«å¢™è®¾ç½®

**è§£å†³æ–¹æ³•**:

å¢åŠ è¶…æ—¶æ—¶é—´ï¼ˆ`src/llm_manager.cpp`ï¼‰ï¼š

```cpp
const unsigned long NETWORK_TIMEOUT = 60000;  // å¢åŠ åˆ° 60 ç§’
const unsigned long STREAM_TIMEOUT = 60000;
```

#### é—®é¢˜ï¼šAPI Key æ— æ•ˆ

**ç—‡çŠ¶**:
- ä¸²å£è¾“å‡º "API key invalid"
- HTTP å“åº”ç  401

**è§£å†³æ–¹æ³•**:

1. ç™»å½•æä¾›å•†ç½‘ç«™éªŒè¯ API Key æ˜¯å¦æœ‰æ•ˆ
2. æ£€æŸ¥ API Key æ˜¯å¦è¿‡æœŸ
3. ç¡®è®¤ API Key æ ¼å¼æ­£ç¡®ï¼ˆæ— å¤šä½™ç©ºæ ¼ï¼‰

#### é—®é¢˜ï¼šæ¨¡å‹ä¸å­˜åœ¨

**ç—‡çŠ¶**:
- ä¸²å£è¾“å‡º "Model not found"
- HTTP å“åº”ç  404

**è§£å†³æ–¹æ³•**:

1. æ£€æŸ¥æ¨¡å‹åç§°æ‹¼å†™
2. ç¡®è®¤æä¾›å•†æ”¯æŒè¯¥æ¨¡å‹
3. æ›´æ–°æ¨¡å‹åˆ—è¡¨ï¼ˆè®¿é—®æä¾›å•†æ–‡æ¡£ï¼‰

### 9.3 OLED æ˜¾ç¤ºé—®é¢˜

#### é—®é¢˜ï¼šOLED æ— æ˜¾ç¤º

**å¯èƒ½åŸå› **:

1. **I2C æ¥çº¿é”™è¯¯**
   - æ£€æŸ¥ SDA (GPIO4) å’Œ SCL (GPIO5) è¿æ¥
   
2. **OLED åœ°å€é”™è¯¯**
   - é»˜è®¤åœ°å€ 0x3Cï¼Œéƒ¨åˆ†æ¨¡å—ä½¿ç”¨ 0x3D

**è§£å†³æ–¹æ³•**:

**I2C æ‰«æä»£ç **:

```cpp
#include <Wire.h>

void scanI2C() {
    Wire.begin(OLED_SDA_PIN, OLED_SCL_PIN);
    
    Serial.println("Scanning I2C bus...");
    for (byte address = 1; address < 127; address++) {
        Wire.beginTransmission(address);
        byte error = Wire.endTransmission();
        
        if (error == 0) {
            Serial.printf("I2C device found at address 0x%02X\n", address);
        }
    }
    Serial.println("Scan complete.");
}
```

**ä¿®æ”¹ OLED åœ°å€**:

åœ¨ `include/hardware_config.h` ä¸­ï¼š

```cpp
#define OLED_ADDR 0x3D  // ä¿®æ”¹ä¸ºæ‰«æåˆ°çš„åœ°å€
```

#### é—®é¢˜ï¼šOLED æ˜¾ç¤ºä¹±ç 

**å¯èƒ½åŸå› **:

1. **å­—ä½“ä¸æ”¯æŒä¸­æ–‡**
   - U8g2 é»˜è®¤å­—ä½“ä»…æ”¯æŒè‹±æ–‡

**è§£å†³æ–¹æ³•**:

ä½¿ç”¨ä¸­æ–‡å­—ä½“ï¼ˆ`src/ui_manager.cpp`ï¼‰ï¼š

```cpp
hardware.getDisplay().setFont(u8g2_font_wqy12_t_gb2312);  // ä¸­æ–‡å­—ä½“
```

### 9.4 USB Shell é—®é¢˜

#### é—®é¢˜ï¼šä¸»æœºä»£ç†æ— æ³•è¿æ¥è®¾å¤‡

**ç—‡çŠ¶**:
- ä»£ç†ç¨‹åºè¾“å‡º "Failed to connect to ESP32"

**å¯èƒ½åŸå› **:

1. **CDC é©±åŠ¨æœªå®‰è£…** (Windows)
   - æ£€æŸ¥è®¾å¤‡ç®¡ç†å™¨ï¼Œæ˜¯å¦æ˜¾ç¤º "æœªçŸ¥è®¾å¤‡"

2. **ä¸²å£æƒé™ä¸è¶³** (Linux/macOS)
   - å½“å‰ç”¨æˆ·æ²¡æœ‰è®¿é—®ä¸²å£çš„æƒé™

**è§£å†³æ–¹æ³•**:

**Windows**:

1. å®‰è£… CP2102 æˆ– CH340 é©±åŠ¨ï¼ˆæ ¹æ®å¼€å‘æ¿ï¼‰
2. é‡æ–°æ’æ‹” USB

**Linux**:

```bash
# æ·»åŠ ç”¨æˆ·åˆ° dialout ç»„
sudo usermod -a -G dialout $USER

# æ³¨é”€å¹¶é‡æ–°ç™»å½•
```

**macOS**:

```bash
# æˆäºˆç»ˆç«¯å®Œå…¨ç£ç›˜è®¿é—®æƒé™
ç³»ç»Ÿåå¥½è®¾ç½® â†’ å®‰å…¨æ€§ä¸éšç§ â†’ å®Œå…¨ç£ç›˜è®¿é—®æƒé™ â†’ æ·»åŠ ç»ˆç«¯
```

#### é—®é¢˜ï¼šShell å‘½ä»¤æ— è¾“å‡º

**ç—‡çŠ¶**:
- AI å“åº” "å‘½ä»¤å·²æ‰§è¡Œ"ï¼Œä½†æ²¡æœ‰è¾“å‡º

**å¯èƒ½åŸå› **:

1. **å‘½ä»¤æœ¬èº«æ— è¾“å‡º**
   - ä¾‹å¦‚ `cd` å‘½ä»¤æˆåŠŸæ‰§è¡Œä½†ä¸äº§ç”Ÿè¾“å‡º

2. **å‘½ä»¤æ‰§è¡Œå¤±è´¥**
   - æ£€æŸ¥ exitCode æ˜¯å¦ä¸º 0

**è§£å†³æ–¹æ³•**:

æŸ¥çœ‹ä¸»æœºä»£ç†çš„è¯¦ç»†æ—¥å¿—ï¼š

```bash
./agent --debug
```

### 9.5 æ€§èƒ½é—®é¢˜

#### é—®é¢˜ï¼šè®¾å¤‡é¢‘ç¹é‡å¯

**ç—‡çŠ¶**:
- ä¸²å£è¾“å‡º "Brownout detector was triggered"
- è®¾å¤‡åœ¨ LLM è°ƒç”¨æ—¶é‡å¯

**å¯èƒ½åŸå› **:

1. **ä¾›ç”µä¸è¶³**
   - USB ç«¯å£ç”µæµä¸è¶³ï¼ˆ< 500mAï¼‰

2. **å†…å­˜è€—å°½**
   - DRAM ä½¿ç”¨ç‡è¿‡é«˜

**è§£å†³æ–¹æ³•**:

**ä¾›ç”µ**:

- ä½¿ç”¨è´¨é‡å¥½çš„ USB ç”µæºé€‚é…å™¨ï¼ˆ5V 2Aï¼‰
- é¿å…ä½¿ç”¨ USB Hub
- æ›´æ¢ USB æ•°æ®çº¿

**å†…å­˜**:

- æ¸…é™¤å¯¹è¯å†å²
- å‡å°‘ WebSocket è¿æ¥æ•°
- é‡å¯è®¾å¤‡

#### é—®é¢˜ï¼šå“åº”é€Ÿåº¦æ…¢

**ç—‡çŠ¶**:
- LLM è°ƒç”¨è€—æ—¶è¶…è¿‡ 20 ç§’
- Web ç•Œé¢å¡é¡¿

**å¯èƒ½åŸå› **:

1. **ç½‘ç»œå»¶è¿Ÿé«˜**
2. **å¯¹è¯å†å²è¿‡é•¿**
3. **æ¨¡å‹é€‰æ‹©ä¸å½“**

**è§£å†³æ–¹æ³•**:

1. **ä¼˜åŒ–ç½‘ç»œ**:
   - ä½¿ç”¨æœ‰çº¿è¿æ¥åˆ°è·¯ç”±å™¨ï¼ˆé€šè¿‡ WiFi æ¡¥æ¥ï¼‰
   - é€‰æ‹©åœ°ç†ä½ç½®è¿‘çš„ LLM æä¾›å•†

2. **æ¸…é™¤å†å²**:
   - å®šæœŸæ¸…é™¤å¯¹è¯å†å²

3. **é€‰æ‹©å¿«é€Ÿæ¨¡å‹**:
   - DeepSeek-chat æ¯” DeepSeek-reasoner å¿«
   - é¿å…ä½¿ç”¨è¶…å¤§æ¨¡å‹

---

## 10. æœ€ä½³å®è·µ

### 10.1 æ—¥å¸¸ä½¿ç”¨å»ºè®®

#### 1. å®šæœŸé‡å¯è®¾å¤‡

**é¢‘ç‡**: æ¯å‘¨ 1 æ¬¡

**åŸå› **: æ¸…ç†å†…å­˜ç¢ç‰‡ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼

**æ“ä½œ**: æ‹”æ’ USB æˆ–é€šè¿‡ Web ç•Œé¢é‡å¯

#### 2. ç®¡ç†å¯¹è¯å†å²

**å»ºè®®**:
- å¯¹è¯ä¸»é¢˜åˆ‡æ¢æ—¶æ¸…é™¤å†å²
- é•¿æœŸä½¿ç”¨åæ¸…é™¤å†å²
- æ„Ÿè§‰ AI å›å¤ä¸å¯¹åŠ²æ—¶æ¸…é™¤å†å²

#### 3. é€‰æ‹©åˆé€‚çš„æ¨¡å¼

| ä»»åŠ¡ç±»å‹ | æ¨èæ¨¡å¼ |
|----------|----------|
| é—²èŠã€å’¨è¯¢ | èŠå¤©æ¨¡å¼ |
| çŸ¥è¯†é—®ç­” | èŠå¤©æ¨¡å¼ |
| æ–‡ä»¶æ“ä½œ | é«˜çº§æ¨¡å¼ |
| ç³»ç»Ÿæ§åˆ¶ | é«˜çº§æ¨¡å¼ |
| è®¾å¤‡æ§åˆ¶ | é«˜çº§æ¨¡å¼ |

#### 4. API Key å®‰å…¨

**å»ºè®®**:
- ä¸è¦åœ¨å…¬å…±åœºåˆå±•ç¤º API Key
- å®šæœŸæ›´æ¢ API Key
- ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–ä¸“ç”¨é…ç½®å·¥å…·
- ç›‘æ§ API ä½¿ç”¨é‡

### 10.2 å¼€å‘è€…å»ºè®®

#### 1. ç‰ˆæœ¬æ§åˆ¶

**ä¸è¦æäº¤** `config.json` åˆ° Gitï¼š

`.gitignore`:

```
data/config.json
*.json.backup
```

**æä¾›é…ç½®æ¨¡æ¿**:

`config.json.template`:

```json
{
  "last_used": {
    "llm_provider": "",
    "model": "",
    "wifi_ssid": ""
  },
  "llm_providers": {
    "deepseek": {
      "api_key": "YOUR_API_KEY_HERE",
      "models": ["deepseek-chat"]
    }
  },
  "wifi_networks": [
    {
      "ssid": "YOUR_WIFI_SSID",
      "password": "YOUR_WIFI_PASSWORD"
    }
  ]
}
```

#### 2. è°ƒè¯•æŠ€å·§

**å¯ç”¨è¯¦ç»†æ—¥å¿—**:

```cpp
// åœ¨ platformio.ini ä¸­
build_flags = 
  -DCORE_DEBUG_LEVEL=5  // 0=æ— , 5=è¯¦ç»†
```

**ç›‘æ§ä¸²å£è¾“å‡º**:

```bash
pio device monitor --baud 115200 --filter direct
```

**ä½¿ç”¨æ–­ç‚¹è°ƒè¯•**:

PlatformIO æ”¯æŒ GDB è°ƒè¯•ï¼ˆéœ€è¦ JTAG é€‚é…å™¨ï¼‰

#### 3. æ€§èƒ½åˆ†æ

**ç›‘æ§å†…å­˜ä½¿ç”¨**:

```cpp
void printMemoryUsage() {
    Serial.printf("Free DRAM: %d bytes\n", ESP.getFreeHeap());
    Serial.printf("Free PSRAM: %d bytes\n", ESP.getFreePsram());
    Serial.printf("Largest free block: %d bytes\n", ESP.getMaxAllocHeap());
}
```

**ç›‘æ§ä»»åŠ¡çŠ¶æ€**:

```cpp
void printTaskInfo() {
    Serial.printf("Task: %s, Stack: %d, Priority: %d\n",
                  pcTaskGetName(NULL),
                  uxTaskGetStackHighWaterMark(NULL),
                  uxTaskPriorityGet(NULL));
}
```

### 10.3 å®‰å…¨å»ºè®®

#### 1. ç½‘ç»œå®‰å…¨

**å»ºè®®**:
- åœ¨ä¿¡ä»»çš„ WiFi ç½‘ç»œä¸Šä½¿ç”¨
- é¿å…åœ¨å…¬å…± WiFi ä¸Šè¾“å…¥æ•æ„Ÿä¿¡æ¯
- è€ƒè™‘æ·»åŠ  Web ç•Œé¢èº«ä»½éªŒè¯

#### 2. å‘½ä»¤æ‰§è¡Œå®‰å…¨

**é£é™©**: é«˜çº§æ¨¡å¼ä¸‹ AI å¯ä»¥æ‰§è¡Œä»»æ„ Shell å‘½ä»¤

**å»ºè®®**:
- è°¨æ…ä½¿ç”¨é«˜çº§æ¨¡å¼
- å®¡æŸ¥ AI ç”Ÿæˆçš„å‘½ä»¤
- å®ç°å‘½ä»¤ç™½åå•ï¼ˆä¸»æœºä»£ç†ä¾§ï¼‰
- é™åˆ¶å‘½ä»¤æ‰§è¡Œæƒé™

#### 3. API Key ä¿æŠ¤

**å»ºè®®**:
- ä½¿ç”¨åªè¯» API Keyï¼ˆå¦‚æœæä¾›å•†æ”¯æŒï¼‰
- è®¾ç½® API ä½¿ç”¨é™é¢
- å®šæœŸæ£€æŸ¥ API ä½¿ç”¨æƒ…å†µ
- å‘ç°æ³„éœ²ç«‹å³æ›´æ¢

---

## 11. API é›†æˆ

### 11.1 é€šè¿‡ WebSocket é›†æˆ

#### è¿æ¥ WebSocket

```javascript
const ws = new WebSocket('ws://192.168.1.100/ws');

ws.onopen = () => {
    console.log('WebSocket connected');
};

ws.onmessage = (event) => {
    const message = JSON.parse(event.data);
    console.log('Received:', message);
    
    if (message.type === 'chat_message') {
        console.log('Bot:', message.text);
    } else if (message.type === 'tool_call') {
        console.log('Tool:', message.tool_name, message.tool_args);
    }
};

ws.onerror = (error) => {
    console.error('WebSocket error:', error);
};

ws.onclose = () => {
    console.log('WebSocket disconnected');
};
```

#### å‘é€æ¶ˆæ¯

**èŠå¤©æ¶ˆæ¯**:

```javascript
ws.send(JSON.stringify({
    type: 'chat_message',
    text: 'ä½ å¥½ï¼Œå¸®æˆ‘åˆ—å‡ºæ–‡ä»¶'
}));
```

**æ›´æ–°é…ç½®**:

```javascript
ws.send(JSON.stringify({
    type: 'update_config',
    config: {
        last_used: {
            llm_provider: 'deepseek',
            model: 'deepseek-chat',
            wifi_ssid: 'MyWiFi'
        },
        // ... å®Œæ•´é…ç½®
    }
}));
```

**æ¸…é™¤å¯¹è¯å†å²**:

```javascript
ws.send(JSON.stringify({
    type: 'clear_history'
}));
```

**æ§åˆ¶ GPIO**:

```javascript
ws.send(JSON.stringify({
    type: 'gpio_control',
    gpio: 'led1',
    state: true
}));
```

### 11.2 é€šè¿‡ HTTP é›†æˆ

#### è·å–é™æ€æ–‡ä»¶

```bash
curl http://192.168.1.100/
curl http://192.168.1.100/style.css
curl http://192.168.1.100/script.js
```

#### è·å–é…ç½® (éœ€è¦æ·»åŠ  REST API)

**ç¤ºä¾‹å®ç°**:

åœ¨ `src/web_manager.cpp` ä¸­æ·»åŠ ï¼š

```cpp
void WebManager::setupRoutes() {
    // ... ç°æœ‰è·¯ç”±
    
    // GET /api/config
    server.on("/api/config", HTTP_GET, [this](AsyncWebServerRequest *request){
        AsyncResponseStream *response = request->beginResponseStream("application/json");
        serializeJson(configManager.getConfig(), *response);
        request->send(response);
    });
    
    // POST /api/config
    server.on("/api/config", HTTP_POST, [](AsyncWebServerRequest *request){
        // å¤„ç†é…ç½®æ›´æ–°
    }, NULL, [this](AsyncWebServerRequest *request, uint8_t *data, size_t len, size_t index, size_t total){
        // å¤„ç† JSON æ•°æ®
        JsonDocument doc;
        deserializeJson(doc, data, len);
        // æ›´æ–°é…ç½®...
        request->send(200, "application/json", "{\"status\":\"success\"}");
    });
}
```

**è°ƒç”¨ç¤ºä¾‹**:

```bash
# è·å–é…ç½®
curl http://192.168.1.100/api/config

# æ›´æ–°é…ç½®
curl -X POST http://192.168.1.100/api/config \
  -H "Content-Type: application/json" \
  -d '{"last_used":{"llm_provider":"deepseek"}}'
```

### 11.3 é€šè¿‡ USB CDC é›†æˆ

#### Python ç¤ºä¾‹

```python
import serial
import json
import uuid

# æ‰“å¼€ä¸²å£
ser = serial.Serial('/dev/ttyACM0', 115200, timeout=1)

def send_message(msg_type, payload):
    """å‘é€æ¶ˆæ¯åˆ° ESP32"""
    message = {
        "requestId": str(uuid.uuid4()),
        "type": msg_type,
        "payload": payload
    }
    ser.write((json.dumps(message) + '\n').encode())
    print(f"Sent: {message}")

def receive_message():
    """æ¥æ”¶ ESP32 çš„æ¶ˆæ¯"""
    line = ser.readline().decode('utf-8').strip()
    if line:
        message = json.loads(line)
        print(f"Received: {message}")
        return message
    return None

# å‘é€ç”¨æˆ·è¾“å…¥
send_message("userInput", "å¸®æˆ‘åˆ—å‡ºæ–‡ä»¶")

# æ¥æ”¶å“åº”
while True:
    msg = receive_message()
    if msg:
        if msg['type'] == 'shellCommand':
            # æ‰§è¡Œ Shell å‘½ä»¤
            import subprocess
            result = subprocess.run(
                msg['payload'],
                shell=True,
                capture_output=True,
                text=True
            )
            # å›ä¼ ç»“æœ
            send_message("shellCommandResult", {
                "command": msg['payload'],
                "stdout": result.stdout,
                "stderr": result.stderr,
                "exitCode": result.returncode
            })
        elif msg['type'] == 'aiResponse':
            print(f"AI: {msg['payload']}")
            break
```

---

## é™„å½•

### A. å¿«æ·é”®å‚è€ƒ

#### Web ç•Œé¢

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| Enter | å‘é€æ¶ˆæ¯ |
| Esc | å…³é—­è®¾ç½®é¢æ¿ |
| Ctrl+K | æ¸…é™¤å¯¹è¯å†å² |

#### OLED ç•Œé¢

| æŒ‰é”®ç»„åˆ | åŠŸèƒ½ |
|----------|------|
| é•¿æŒ‰ Button A (3ç§’) | é‡å¯è®¾å¤‡ |
| é•¿æŒ‰ Button B (3ç§’) | è¿›å…¥æ¢å¤æ¨¡å¼ |

### B. LED çŠ¶æ€é€ŸæŸ¥

| RGB LED é¢œè‰² | çŠ¶æ€ |
|--------------|------|
| ğŸ”µ è“è‰²é—ªçƒ | å¯åŠ¨ä¸­ |
| ğŸŸ¢ ç»¿è‰²å¸¸äº® | WiFi å·²è¿æ¥ |
| ğŸŸ¡ é»„è‰²é—ªçƒ | WiFi è¿æ¥ä¸­ |
| ğŸ”´ çº¢è‰²é—ªçƒ | é”™è¯¯ |
| âšª ç™½è‰²é—ªçƒ | LLM è¯·æ±‚ä¸­ |
| ğŸŸ£ ç´«è‰²å¸¸äº® | OTA æ›´æ–°ä¸­ |

### C. é”™è¯¯ä»£ç 

| é”™è¯¯ç  | è¯´æ˜ | è§£å†³æ–¹æ³• |
|--------|------|----------|
| E001 | WiFi è¿æ¥å¤±è´¥ | æ£€æŸ¥ SSID å’Œå¯†ç  |
| E002 | LLM API è°ƒç”¨å¤±è´¥ | æ£€æŸ¥ API Key å’Œç½‘ç»œ |
| E003 | é…ç½®æ–‡ä»¶æŸå | åˆ é™¤ config.json å¹¶é‡å¯ |
| E004 | å†…å­˜ä¸è¶³ | é‡å¯è®¾å¤‡ |
| E005 | USB CDC åˆå§‹åŒ–å¤±è´¥ | é‡æ–°æ’æ‹” USB |

### D. æ”¯æŒèµ„æº

- **é¡¹ç›®ä»“åº“**: https://github.com/your-repo/NOOX
- **é—®é¢˜åé¦ˆ**: https://github.com/your-repo/NOOX/issues
- **æŠ€æœ¯æ–‡æ¡£**: https://docs.noox.dev
- **ç¤¾åŒºè®ºå›**: https://forum.noox.dev

---

**æ–‡æ¡£ç»“æŸ**

æ„Ÿè°¢ä½¿ç”¨ NOOX æ™ºèƒ½ç¡¬ä»¶å¹³å°ï¼å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚

